<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Boulangerie des Pains</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #000; color: #fff;
    padding: 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
    position: relative;
  }
  h1 { margin-bottom: 10px; color: #ff69b4; text-shadow: 0 0 10px #ff69b4; }
  #menu-btn { position: fixed; top: 20px; right: 20px; background: transparent; border: none; font-size: 26px; cursor: pointer; color: #ff69b4; }
  #overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; display: none; flex-direction: column; align-items: center; padding-top: 60px; z-index: 999; }
  #close-menu { position: fixed; top: 20px; right: 20px; background: transparent; border: none; font-size: 28px; cursor: pointer; color: #ff69b4; }
  #profiles { margin-top: 40px; text-align: center; color: #ff69b4; }
  #input-zone { display: flex; gap: 10px; margin-bottom: 20px; align-items: center; }
  select, input { padding: 8px 12px; border-radius: 8px; border: 1px solid #555; background: #111; color: #fff; }
  button { padding: 8px 12px; border-radius: 8px; border: none; background: #ff69b4; cursor: pointer; }
  #pain-list { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; max-width: 600px; }
  .pain-item { background: #222; padding: 10px 14px; border-radius: 20px; display: flex; flex-direction: column; align-items: center; gap: 6px; border: 2px solid #ff69b4; box-shadow: 0 0 15px #ff69b4; }
  .author-name { font-weight: bold; color: #ff69b4; text-shadow: 0 0 5px #ff69b4; }
  .delete-btn { background: transparent; border: none; cursor: pointer; font-size: 14px; color: #ff69b4; }
  .stars { display: flex; gap: 3px; cursor: pointer; }
  .star { font-size: 18px; color: #555; }
  .star.filled { color: #ff69b4; text-shadow: 0 0 5px #ff69b4; }
  .rating-text { font-size: 16px; color: #ff69b4; }
</style>
</head>
<body>
  <button id="menu-btn">â˜°</button>
  <div id="overlay">
    <button id="close-menu">âœ–</button>
    <h2>Profils des Auteurs</h2>
    <div id="profiles"></div>
  </div>

  <h1>Boulangerie des Pains ğŸ¥–ğŸ’—</h1>
  <div id="input-zone">
    <select id="author-select">
      <option value="ToxicoğŸš¬ğŸ˜">ToxicoğŸš¬ğŸ˜</option>
      <option value="FalafelğŸ’„ğŸ¤­">FalafelğŸ’„ğŸ¤­</option>
      <option value="GouminğŸŒ¸ğŸ˜˜">GouminğŸŒ¸ğŸ˜˜</option>
      <option value="MousieuhğŸ’…ğŸ¤ª">MousieuhğŸ’…ğŸ¤ª</option>
    </select>
    <input type="text" id="name-input" placeholder="Nom du pain...">
    <button id="add-btn">Ajouter</button>
  </div>
  <div id="pain-list"></div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getFirestore, collection, addDoc, onSnapshot, doc, deleteDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDzGayU8pmX9ll1zJ7IFh6h0-0hQRDYuXo",
    authDomain: "boulangerie-5dcf4.firebaseapp.com",
    projectId: "boulangerie-5dcf4",
    storageBucket: "boulangerie-5dcf4.firebasestorage.app",
    messagingSenderId: "930918869651",
    appId: "1:930918869651:web:14a5ab61066020b7213b66",
    measurementId: "G-B9SE4VKGKC"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const painsRef = collection(db, "pains");

  const input = document.getElementById('name-input');
  const authorSelect = document.getElementById('author-select');
  const addBtn = document.getElementById('add-btn');
  const painList = document.getElementById('pain-list');
  const overlay = document.getElementById('overlay');
  const menuBtn = document.getElementById('menu-btn');
  const closeMenu = document.getElementById('close-menu');
  const profilesDiv = document.getElementById('profiles');

  addBtn.onclick = async () => {
    const name = input.value.trim();
    const author = authorSelect.value;
    if (name !== '') {
      await addDoc(painsRef, { name, author, rating: 0 });
      input.value = '';
    }
  };

  function renderProfiles(pains) {
    const authors = ["ToxicoğŸš¬ğŸ˜","FalafelğŸ’„ğŸ¤­","GouminğŸŒ¸ğŸ˜˜","MousieuhğŸ’…ğŸ¤ª"];
    profilesDiv.innerHTML = '';
    authors.forEach(author => {
      const list = pains.filter(p => p.data.author === author);
      const count = list.length;
      const avg = count > 0 ? list.reduce((a,p)=>a+(p.data.rating||0),0)/count : 0;
      profilesDiv.innerHTML += `<h3>${author}</h3><p>Pains: ${count}</p><p>Moyenne: ${avg.toFixed(2)}/5</p><hr>`;
    });
  }

  onSnapshot(painsRef, snapshot => {
    const data = snapshot.docs.map(doc => ({ id: doc.id, data: doc.data() }));
    painList.innerHTML = '';
    data.forEach(item => {
      const div = document.createElement('div');
      div.className = 'pain-item';

      div.innerHTML = `<div class="author-name">${item.data.author}</div>
      <div class="top-line">${item.data.name} <button class="delete-btn">ğŸ—‘ï¸</button></div>`;

      div.querySelector('.delete-btn').onclick = () => deleteDoc(doc(db, "pains", item.id));

      const starContainer = document.createElement('div');
      starContainer.className = 'stars';
      const rating = item.data.rating || 0;
      for (let i = 1; i <= 5; i++) {
        const s = document.createElement('span');
        s.className = 'star' + (i <= rating ? ' filled' : '');
        s.textContent = 'â˜…';
        s.onclick = () => updateDoc(doc(db, "pains", item.id), { rating: i });
        starContainer.appendChild(s);
      }
      div.appendChild(starContainer);

      if (rating > 0 && overlay.style.display !== 'flex') {
        const rt = document.createElement('div');
        rt.className = 'rating-text';
        rt.textContent = `(Note: ${rating}/5)`;
        div.appendChild(rt);
      }

      painList.appendChild(div);
    });

    renderProfiles(data);
  });

  menuBtn.onclick = () => overlay.style.display = 'flex';
  closeMenu.onclick = () => overlay.style.display = 'none';
</script>
</body>
</html>
